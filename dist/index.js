// Generated by CoffeeScript 1.12.4
(function() {
  var DateTimePicker, DtPickerButtonPanel, DtPickerCalendar, DtPickerInputPanel, ensureMoment;

  DateTimePicker = (function() {
    DateTimePicker.controller = DateTimePicker;

    DateTimePicker.bindings = {
      value: '<',
      dateFormat: '<',
      timeFormat: '<',
      visible: '<',
      onOpen: '<',
      onHide: '<',
      onChange: '<'
    };

    DateTimePicker.template = '<div class="dt-picker-ng-comp" ng-show="$ctrl.visible">\n  <dt-picker-input-panel\n    value="$ctrl.value"\n    date-format="$ctrl.dateFormat"\n    on-update="$ctrl.binded.update">\n  </dt-picker-input-panel>\n\n  <dt-picker-calendar\n    value="$ctrl.value"\n    date-format="$ctrl.dateFormat"\n    on-update="$ctrl.binded.update"\n  ></dt-picker-calendar>\n\n  <dt-picker-button-panel\n    on-cancel="$ctrl.binded.cancel"\n    on-accept="$ctrl.binded.accept">\n  </dt-picker-button>\n</div>';

    function DateTimePicker() {
      this.binded = {
        update: this.update.bind(this),
        cancel: this.cancel.bind(this),
        accept: this.accept.bind(this)
      };
    }

    DateTimePicker.prototype.$onInit = function() {
      var dummy;
      dummy = function() {};
      if (typeof this.onOpen !== "function") {
        this.onOpen = dummy;
      }
      if (typeof this.onHide !== "function") {
        this.onHide = dummy;
      }
      if (typeof this.onChange !== "function") {
        this.onChange = dummy;
      }
      this.dateFormat = this.dateFormat || "DD MMMM YYYY";
      this.timeFormat = this.timeFormat || "HH:mm";
      this.prevValue = this.value && new Date(this.value);
      return this.update(this.prevValue || new Date());
    };

    DateTimePicker.prototype.$onChanges = function() {
      return this.$onInit();
    };

    DateTimePicker.prototype.update = function(val) {
      return this.value = new Date(val || this.value);
    };

    DateTimePicker.prototype.show = function() {
      this.visible = true;
      return this.onOpen(this);
    };

    DateTimePicker.prototype.hide = function() {
      this.visible = false;
      return this.onHide(this);
    };

    DateTimePicker.prototype.cancel = function() {
      this.update(this.prevValue || new Date());
      return this.hide();
    };

    DateTimePicker.prototype.accept = function() {
      if (!this.prevValue || this.prevValue.valueOf() !== this.value.valueOf()) {
        this.onChange(this.value);
      }
      return this.hide();
    };

    return DateTimePicker;

  })();

  angular.module('dateTimePickerNgComponent', []).component('dateTimePicker', DateTimePicker);

  DtPickerButtonPanel = (function() {
    DtPickerButtonPanel.controller = DtPickerButtonPanel;

    DtPickerButtonPanel.bindings = {
      onCancel: '<',
      onAccept: '<',
      cacnelText: '<',
      acceptText: '<',
      cancelButtonClass: '<',
      acceptButtonClass: '<'
    };

    DtPickerButtonPanel.template = "<div class=\"dt-picker-button-panel\">\n  <div class=\"cancel-button\">\n    <button class=\"dt-picker-btn-cancel\"\n            ng-class=\"$ctrl.cancelButtonClass\"\n            ng-click=\"$ctrl.onCancel()\">\n      {{$ctrl.cancelText}}\n    </button>\n  </div>\n  <div class=\"accept-button\">\n    <button class=\"dt-picker-btn-accept\"\n            ng-class=\"$ctrl.acceptButtonClass\"\n            ng-click=\"$ctrl.onAccept()\">\n      {{$ctrl.acceptText}}\n    </button>\n  </div>\n</div>";

    function DtPickerButtonPanel() {}

    DtPickerButtonPanel.prototype.$onInit = function() {
      var dummy;
      dummy = function() {};
      if (typeof this.onCancel !== "function") {
        this.onCancel = dummy;
      }
      if (typeof this.onAccept !== "function") {
        this.onAccept = dummy;
      }
      this.cancelText = this.cancelText || 'cancel';
      return this.acceptText = this.acceptText || 'ok';
    };

    DtPickerButtonPanel.prototype.$onChanges = function() {
      return this.$onInit;
    };

    return DtPickerButtonPanel;

  })();

  angular.module("dateTimePickerNgComponent").component('dtPickerButtonPanel', DtPickerButtonPanel);

  DtPickerCalendar = (function() {
    DtPickerCalendar.controller = DtPickerCalendar;

    DtPickerCalendar.inject = ['moment'];

    DtPickerCalendar.bindings = {
      value: '<',
      onUpdate: '<',
      dateFormat: '<'
    };

    DtPickerCalendar.template = "<div class=\"calendar-month-switcher\">\n  <div class=\"calendar-month-back-button\" ng-click=\"$ctrl.incMonth(-1)\">&lt;</div>\n  <div class=\"calendar-month-name\">{{ $ctrl.moment.format($ctrl.monthYearFormat)}}</div>\n  <div class=\"calendar-month-back-button\" ng-click=\"$ctrl.incMonth(1)\">&gt;</div>\n</div>\n<div class=\"calendar-week\">\n</div>\n<div class=\"calendar-table\">\n  <table>\n    <tr ng-repeat=\"week in $ctrl.weeks track by $index\">\n      <td ng-repeat=\"day in week track by $index\"\n          ng-class=\"day.current\"\n          ng-click=\"day.date && $ctrl.update(day.date)\">\n        {{day.number || \"&nbsp;\"}}\n      </td>\n      <!--dt-picker-calendar-cell\n        ng-repeat=\"day in week\" day=\"{{day}}\"\n      ></dt-picker-calendar-cell-->\n    </tr>\n  </table>\n</div>";

    function DtPickerCalendar(moment) {
      this._moment = moment;
    }

    DtPickerCalendar.prototype.$onInit = function() {
      var dummy;
      dummy = function() {};
      if (typeof this.onUpdate !== 'function') {
        this.onUpdate = dummy;
      }
      this.date = new Date(this.value.getFullYear(), this.value.getMonth(), this.value.getDate());
      this.moment = this._moment(this.date);
      this.current = new Date(this.date);
      this.monthYearFormat = /[^dmshqDeEwWaAkSxXzZo]+/.exec(this.dateFormat)[0];
      return this.initWeeks();
    };

    DtPickerCalendar.prototype.$onChanges = function() {
      return this.$onInit();
    };

    DtPickerCalendar.prototype.initWeeks = function() {
      var d, dayOfWeek, i, j, k, maxDays, ref, week;
      this.moment = this._moment(this.date);
      d = new Date(this.date);
      dayOfWeek = (d.getDay() + 6) % 7;
      week = (function() {
        var k, ref, results;
        results = [];
        for (j = k = 0, ref = dayOfWeek - 1; 0 <= ref ? k <= ref : k >= ref; j = 0 <= ref ? ++k : --k) {
          results.push({
            date: null,
            number: 0
          });
        }
        return results;
      })();
      this.weeks = [week];
      maxDays = this.moment.daysInMonth();
      for (i = k = 1, ref = maxDays; 1 <= ref ? k <= ref : k >= ref; i = 1 <= ref ? ++k : --k) {
        d.setDate(i);
        dayOfWeek = (d.getDay() + 6) % 7;
        week[dayOfWeek] = {
          date: new Date(d),
          number: d.getDate(),
          current: (d.valueOf() === this.current.valueOf() ? 'active' : '')
        };
        if (dayOfWeek === 6 && i < maxDays) {
          week = [];
          this.weeks.push(week);
        }
      }
      return this.weeks[this.weeks.length - 1] = week.concat((function() {
        var l, ref1, results;
        results = [];
        for (j = l = ref1 = dayOfWeek + 1; ref1 <= 6 ? l <= 6 : l >= 6; j = ref1 <= 6 ? ++l : --l) {
          results.push({
            date: null,
            number: 0
          });
        }
        return results;
      })());
    };

    DtPickerCalendar.prototype.incMonth = function(delta) {
      this.date.setMonth(this.date.getMonth() + delta);
      this.initWeeks();
    };

    DtPickerCalendar.prototype.update = function(val) {
      this.value.setFullYear(val.getFullYear());
      this.value.setMonth(val.getMonth());
      this.value.setDate(val.getDate());
      this.onUpdate(this.value);
    };

    return DtPickerCalendar;

  })();

  angular.module("dateTimePickerNgComponent").component('dtPickerCalendar', DtPickerCalendar);

  DtPickerInputPanel = (function() {
    DtPickerInputPanel.controller = DtPickerInputPanel;

    DtPickerInputPanel.inject = ['moment'];

    DtPickerInputPanel.bindings = {
      value: '<',
      dateFormat: '<',
      onUpdate: '<',
      minuteStep: '<'
    };

    DtPickerInputPanel.template = "<div class=\"dt-picker-input-panel\">\n  <div class=\"dt-date-input-group\">\n    <select ng-model=\"$ctrl.date\"\n            ng-change=\"$ctrl.change(\'Date\')\"\n            ng-options=\"d for d in $ctrl.days track by d\">\n    </select>\n    <span class=\"separator\"></span>\n    <select ng-model=\"$ctrl.month\"\n            ng-change=\"$ctrl.change(\'Month\')\"\n            ng-options=\"m for m in $ctrl.months track by m\">\n    </select>\n    <span class=\"separator\"></span>\n    <input ng-model=\"$ctrl.fullyear\" ng-change=\"$ctrl.change(\'FullYear\')\">\n  </div>\n  <div class=\"dt-time-input-group\">\n    <select ng-model=\"$ctrl.hours\"\n            ng-change=\"$ctrl.change(\'Hours\')\"\n            ng-options=\"h for h in $ctrl.allHours track by h\">\n    </select>\n    <span class=\"separator\"></span>\n    <select ng-model=\"$ctrl.minutes\"\n            ng-change=\"$ctrl.change(\'Minutes\')\"\n            ng-options=\"m for m in $ctrl.allMinutes track by m\">\n  </div>\n</div>";

    function DtPickerInputPanel(moment) {
      var i;
      this._moment = moment;
      this.allHours = (function() {
        var k, results;
        results = [];
        for (i = k = 0; k <= 23; i = ++k) {
          results.push(i);
        }
        return results;
      })();
    }

    DtPickerInputPanel.prototype.$onChanges = function() {
      return this.$onInit();
    };

    DtPickerInputPanel.prototype.$onInit = function() {
      var dummy, i, m, minsCount;
      dummy = function() {};
      if (typeof this.onUpdate !== 'function') {
        this.onUpdate = dummy;
      }
      this.moment = this._moment(this.value);
      this.months = this.getMonths(/M+/.exec(this.dateFormat)[0]);
      this.minuteStep = this.minuteStep || 5;
      minsCount = 60 / this.minuteStep;
      if ((m = parseInt(minsCount)) < minsCount) {
        minsCount = m;
      } else {
        minsCount = m - 1;
      }
      this.allMinutes = (function() {
        var k, ref, results;
        results = [];
        for (i = k = 0, ref = minsCount; 0 <= ref ? k <= ref : k >= ref; i = 0 <= ref ? ++k : --k) {
          results.push(i * this.minuteStep);
        }
        return results;
      }).call(this);
      this.days = this.getDays();
      this.date = this.value.getDate();
      this.month = this.months[this.value.getMonth()];
      this.fullyear = this.value.getFullYear();
      this.hours = this.value.getHours();
      return this.minutes = this.value.getMinutes();
    };

    DtPickerInputPanel.prototype.getMonths = function(monthFormat) {
      var i, k, results;
      results = [];
      for (i = k = 0; k <= 11; i = ++k) {
        results.push(this.moment.month(i).format(monthFormat));
      }
      return results;
    };

    DtPickerInputPanel.prototype.getDays = function() {
      var i, k, ref, results;
      results = [];
      for (i = k = 1, ref = this.moment.daysInMonth(); 1 <= ref ? k <= ref : k >= ref; i = 1 <= ref ? ++k : --k) {
        results.push(i);
      }
      return results;
    };

    DtPickerInputPanel.prototype.change = function(datePart) {
      var d, maxDays, val;
      val = this[datePart.toLowerCase()];
      if (datePart === 'Month') {
        val = this.months.indexOf(val);
      }
      if (datePart === 'Month' || datePart === 'FullYear') {
        d = new Date(this.fullyear, this.months.indexOf(this.month), 1);
        maxDays = this._moment(d).daysInMonth();
        if (this.date > maxDays) {
          this.date = maxDays;
          this.change('Date');
        }
      }
      this.value['set' + datePart](val);
      this.moment = this._moment(this.value);
      if (datePart === 'Month' || datePart === 'FullYear') {
        this.days = this.getDays();
      }
      return this.onUpdate(this.value);
    };

    return DtPickerInputPanel;

  })();

  angular.module("dateTimePickerNgComponent").component('dtPickerInputPanel', DtPickerInputPanel);

  ensureMoment = (function() {
    if (!window.moment) {
      throw new Error('dateTimePickerNgComponent: monment.js is required for correct work of dateTimePicker. Please ensure you correctly linked all requirements.');
    } else {
      return function() {
        return window.moment;
      };
    }
  })();

  angular.module('dateTimePickerNgComponent').service('moment', ensureMoment);

}).call(this);
